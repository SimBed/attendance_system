<%= form_with(model: purchase) do |form| %>
  <% if purchase.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(purchase.errors.count, "error") %> prohibited this purchase from being saved:</h2>

      <ul>
        <% purchase.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= form.label :client_id %>
    <%= form.select :client_id, @clients, include_blank: true %>
  </div>

  <!--div class="field">
    <%#= form.label :product_id %>
    <%#= form.select :product_id, @products, { include_blank: true },{ data: {
    remote: true,
    url: '/products/payment',
    method: 'post'
  }} %>
  </div-->

  <div class="field">
    <%= form.label :product_id, 'Product type' %>
    <%= form.select :product_id, @product_types, { include_blank: true }  %>
  </div>

  <div class="field">
    <%= form.label :product_name, 'Product name' %>
    <%= form.select :product_name, @product_names %>
  </div>

  <div class="field">
    <%= form.label :payment %>
    <%= form.number_field :payment %>
  </div>

  <div class="field">
    <%= form.label :dop %>
    <%= form.date_select :dop %>
  </div>

  <div class="field">
    <%= form.label :payment_mode %>
    <%= form.select :payment_mode, options_for_select(@payment_methods), include_blank: true %>
  </div>

  <div class="field">
    <%= form.label :invoice %>
    <%= form.text_field :invoice %>
  </div>

  <div class="field">
    <%= form.label :note %>
    <%= form.text_area :note %>
  </div>

  <% unless @purchase.new_record? %>
  <div class="field" id="ar">
    <%= form.label :adjust_restart %>
    <%= form.check_box :adjust_restart, onclick: "toggleHide()" %>
  </div>

  <div id="ar_payment" class="field ar <%= 'ar_hide' unless @purchase.adjust_restart %>">
    <%= form.label :ar_payment %>
    <%= form.number_field :ar_payment, class: "arvalue" %>
  </div>

  <div class="field ar <%= 'ar_hide' unless @purchase.adjust_restart %>">
    <%= form.label :ar_date %>
    <%= form.date_select :ar_date, {include_blank: true, selected: @purchase.ar_date || Date.today}, {class: "arvalue"} %>
  </div>
  <% end %>

  <div class="actions">
    <%= form.submit @purchase.new_record? ? 'Log Purchase' : 'Update Purchase'  %>
  </div>
<% end %>

<script type="text/javascript">
//   document.getElementById("purchase_product_id").onchange =  function () {
// alert ("this is a test");
//   }
</script>

<script>
$(function() {
    $("select#purchase_product_id").on("change", function() {
      //alert("dan")
        $.ajax({
            url:  '/products/payment',
            type: 'post',
            data: { selected_product_type: $("select#purchase_product_id").val(),
                    selected_product_name: $("select#purchase_product_name").val(),
           }
        });
    });
});
</script>

<script>
  function toggleHide() {
    var currentState = 'hidden';
    if (document.getElementById("ar_payment").classList.contains("ar_hide")) {
        currentState = 'visible';
      }
      var x = document.getElementsByClassName("ar");
      var i;
      for (i = 0; i < x.length; i++) {
        x[i].classList.toggle('ar_hide')
      }
      if (currentState == 'hidden') {
        var x = document.getElementsByClassName("arvalue");
        var i;
        for (i = 0; i < x.length; i++) {
          x[i].value="";
        }
      }
    }
</script>
